!function e(t,n,r){function s(o,l){if(!n[o]){if(!t[o]){var i="function"==typeof require&&require;if(!l&&i)return i(o,!0);if(a)return a(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[o]={exports:{}};t[o][0].call(c.exports,function(e){var n=t[o][1][e];return s(n?n:e)},c,c.exports,e,t,n,r)}return n[o].exports}for(var a="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var s=e("./controllers/SelectCtrl"),a=r(s),o=e("./controllers/CollectCtrl"),l=r(o),i=e("./controllers/CreateCtrl"),u=r(i),c=e("./services/ModelService"),f=r(c),d=e("./filters/featureFilter"),p=r(d),h=e("./filters/labelFilter"),v=r(h);angular.module("myApp",["ui.bootstrap","ui.router","ngTagsInput","timer"]).value("host","jactivity-influx.teco.edu").service("ModelService",f["default"]).controller("SelectCtrl",a["default"]).controller("CollectCtrl",l["default"]).controller("CreateCtrl",u["default"]).filter("feature",p["default"]).filter("label",v["default"]).service("sharedConfig",function(){var e={},t={};return{getFeatures:function(){return e},getLabels:function(){return t},setConfig:function(n,r){e=n,t=r}}}).config(["$httpProvider","$stateProvider","$urlRouterProvider",function(e,t,n){t.state("select",{url:"/select",templateUrl:"select.html",controller:"SelectCtrl"}).state("collect",{url:"/collect",templateUrl:"collect.html",controller:"CollectCtrl"}).state("create",{url:"/create",templateUrl:"create.html",controller:"CreateCtrl"}),n.otherwise("/select")}])},{"./controllers/CollectCtrl":2,"./controllers/CreateCtrl":3,"./controllers/SelectCtrl":4,"./filters/featureFilter":5,"./filters/labelFilter":6,"./services/ModelService":7}],2:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=["$scope","$filter","$location","$templateRequest","$sce","host","sharedConfig",function($scope,$filter,$location,$templateRequest,$sce,host,sharedConfig){"ngInject";var features=sharedConfig.getFeatures(),labels=sharedConfig.getLabels(),ua=detect.parse(navigator.userAgent),sandbox={send:function(e){console.log(e);var t=ua.device.manufacturer+"_"+ua.device.name+"_"+ua.browser.family+"_"+ua.browser.major,n=e.sensor+",label="+labels+",useragent="+t.replace(/\s/g,"")+" ";delete e.sensor;for(var r in e)n+=r+"="+e[r]+",";n=n.substring(0,n.length-1);var s=new XMLHttpRequest;s.open("POST","http://"+host+"/influxdb/write?db=jactivity"),s.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),s.send(n)}};$scope.HTML="";var sensors=[];features.forEach(function(key){"undefined"!=typeof key.html&&""!==key.html&&(console.log("html/"+key.html),$templateRequest("html/"+key.html).then(function(e){$scope.sensorHTML=$sce.trustAsHtml(e)}));var req=new XMLHttpRequest,fileLocation="../sensors/"+key.feature+"/"+key.feature+".js";req.open("GET",fileLocation),req.onreadystatechange=function(){eval(client.responseText);var sensor=new window[key.feature](sandbox);sensors.push(sensor)}}),$scope.timerRunning=!1,$scope.start=function(e){$scope.$broadcast("timer-start"),$scope.timerRunning=!0,sensors.forEach(function(e){e.start()})},$scope.stop=function(){console.log("stop"),$scope.timerRunning=!1,sensors.forEach(function(e){e.stop(),delete window.sensor}),$location.path("/sensor")}}],module.exports=exports["default"]},{}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=["$scope","$filter","$location","$http","$q","ModelService","host","sharedConfig",function(e,t,n,r,s,a,o,l){"ngInject";function i(e){return e.charAt(0).toUpperCase()+e.slice(1)}e.ua=detect.parse(navigator.userAgent),e.features=[],e.sensors=[],a.getFeatures().then(function(n){e.features=n.data,e.sensors=t("feature")(e.features.sensors)}),e.$watch("features",function(n,r,s){e.sensors=t("feature")(e.features.sensors)},!0),e.labels=[],e.loadLabels=function(e){return a.getLabels().then(function(t){var n=t.data.results[0].series,r=[].concat.apply([],n.map(function(e){return e.values.filter(function(e){return"label"===e[0]}).map(function(e){return e[1]})})).filter(function(e,t,n){return n.indexOf(e)===t}),s=r.map(function(e){return{name:e}});return s.filter(function(t){return-1!=t.name.toLowerCase().indexOf(e.toLowerCase())})})},e.updateJavaScript=function(){console.log("updateJavaScript");var n=t("filter")(e.features.sensors,{value:!0}),a=e.labels;if(e.name&&0!==Object.keys(n).length&&0!==Object.keys(a).length){var o='class jActivity {\n      constructor(host) {\n        this.host = host\n        //if(localStorage.getItem("decisionTree")) {\n        //	resolve(localStorage.getItem(\'decisionTree\', xsl_file))\n        //} else {\n    	    this.XSL = new Promise((resolve, reject) => {\n    	      var onSuccess = function(xsl_file) {\n    	        localStorage.setItem(\'decisionTree\', xsl_file)\n    	        resolve(xsl_file)\n    	      }\n    	      $.ajax({\n    	        type: "GET",\n    	        url: ("http://" + host + "/transformationstyles/pmml2js_decision_tree.xsl"),\n    	        success: onSuccess\n    	      })\n    	    })\n    	//}\n\n      }\n\n      %CLASSIFIER%\n    }\n\n    class Classifier {\n      constructor(sensors, callback, label, interval, host, XSL) {\n        this.sensors = sensors\n        this.callback = callback\n        this.label = label\n        this.interval = interval\n        this.host = host\n        this.XSL = XSL\n        this.decisionTree = null\n        const scope = this\n        this.createDecisionTree(scope)\n        this.dataset = {}\n        window.setInterval((...args) => this.evaluateDataActivity(...args), interval)\n      }\n\n      createDecisionTree(scope) {\n        function onSuccess(data, XSL) {\n          let model = $.parseXML(data.pop())\n          let generated_code = transform(model, XSL)\n          scope.decisionTree = eval(generated_code.textContent)\n        }\n        this.XSL.then(function(XSL) {\n          $.ajax({\n            type: "POST",\n            url: ("http://" + scope.host + "/ocpu/ocpu/library/jActivity2PMML/R/getPMML/json"),\n            data: \'json_data={"sensor": \' + JSON.stringify(scope.sensors) + \',"label": \' + JSON.stringify(scope.label) + \',"classifier": "rpart"}\',\n            success: function(data) {\n              onSuccess(data, XSL)\n            },\n            dataType: "json"\n          })\n        })\n      }\n\n      evaluateDataActivity() {\n        throw new Error("Not implemented")\n      }\n\n    }\n',l="class %NAME%Classifier extends Classifier {\n      constructor(callback, label, interval, host, XSL) {\n        super(%FEATURES%, callback, label, interval, host, XSL)\n        %INITIALIZE%\n      }\n\n      %HELPERFUNCTIONS%\n\n      evaluateDataActivity() {\n        let averageData = {}\n\n        for (var feature in this.dataset) {\n          averageData[feature] = this.dataset[feature].reduce(function(a, b) {\n            return a + b\n          }, 0) / this.dataset[feature].length\n          this.dataset[feature] = []\n        }\n\n        if (this.decisionTree == null) return\n\n        let res = this.decisionTree.evaluate(averageData).result\n\n        if (res == null) return\n\n        this.callback(res.toLowerCase())\n      }\n    }",u="",c="",f="",d={presets:["es2015"]},p=n.map(function(e){return e.feature}),h=e.name.toLowerCase()+"Classifier(callback, label, interval) {\nreturn new "+i(e.name)+"Classifier(callback, label, interval, this.host, this.XSL)\n}\n",v=[];n.forEach(function(e){v.push(r.get("../sensors/"+e.feature+"/"+e.feature+".initialize.js").then(function(t){return u+=t.data,r.get("../sensors/"+e.feature+"/"+e.feature+".helper.js")}).then(function(e){c+=e.data}))}),s.all(v).then(function(){var t={"%NAME%":i(e.name),"%FEATURES%":JSON.stringify(p),"%INITIALIZE%":u,"%HELPERFUNCTIONS%":c};console.log("Initialize: "+u+"\n Helperfunctions: "+c),f+=l.replace(/%\w+%/g,function(e){return t[e]||e}),f+="\n";var n={"%CLASSIFIER%":h},r=o.replace(/%\w+%/g,function(e){return n[e]||e}),s=r+f;console.log(s);var a=Babel.transform(s,d).code;console.log(a)})}}}],t.exports=n["default"]},{}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=["$scope","$filter","$location","ModelService","host","sharedConfig",function(e,t,n,r,s,a){"ngInject";e.ua=detect.parse(navigator.userAgent),e.features=[],e.sensors=[],r.getFeatures().then(function(n){e.features=n.data,e.sensors=t("feature")(e.features.sensors)}),e.$watch("features",function(n,r,s){e.sensors=t("feature")(e.features.sensors)},!0),e.labels=[],e.loadLabels=function(e){return r.getLabels().then(function(t){var n=t.data.results[0].series,r=[].concat.apply([],n.map(function(e){return e.values.filter(function(e){return"label"===e[0]}).map(function(e){return e[1]})})).filter(function(e,t,n){return n.indexOf(e)===t}),s=r.map(function(e){return{name:e}});return s.filter(function(t){return-1!=t.name.toLowerCase().indexOf(e.toLowerCase())})})},e.next=function(){var r=t("filter")(e.features.sensors,{value:!0});a.setConfig(r,e.labels),n.path("/collect")}}],t.exports=n["default"]},{}],5:[function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function s(){return function(e){if("undefined"!=typeof e){var t=[];e.forEach(function(e){e.value===!0&&t.push(e.feature)}),t=[].concat(r(new Set(t)));var n=[];return t.forEach(function(e){var t={};t.name=e,t.support=Modernizr[e],n.push(t)}),n}}}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=s,t.exports=n["default"]},{}],6:[function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function s(){return function(e){if("undefined"!=typeof e){var t=[];e.forEach(function(e){e.value===!0&&t.concat(e.sensors)}),t=[].concat(r(new Set(t)));var n=[];return t.forEach(function(e){var t={};t.name=e,t.support=Modernizr[e],n.push(t)}),n}}}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=s,t.exports=n["default"]},{}],7:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t,n,s){r(this,e),this.$http=t,this.$q=n,this.$host=s}return e.$inject=["$http","$q","host"],s(e,[{key:"getFeatures",value:function(){var e=this.$q.defer();return this.$http.get("http://"+this.$host+"/sensors/sensors.json").then(function(t){e.resolve(t)}),e.promise}},{key:"getLabels",value:function(){var e=this.$q.defer(),t={method:"GET",url:"http://"+this.$host+"/influxdb/query",params:{db:"jactivity",q:"SHOW TAG VALUES WITH KEY IN (label)"}};return this.$http(t).then(function(t){e.resolve(t)}),e.promise}}]),e}();n["default"]=a,t.exports=n["default"]},{}]},{},[1]);
//# sourceMappingURL=app.min.js.map
